<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.pj.movie.mapper.ReserVationMapper">

    <select id="theatercatg" resultType="com.pj.movie.dto.PmTheaterDto" parameterType="String">
        select *
        from PM_THEATER_CATG

    </select>
    <select id="regionList" resultType="com.pj.movie.dto.PmTheaterDto" parameterType="String">
        select *
        from PM_THEATER
        where PT_AREA = #{ptArea}
    </select>
    <select id="movieList" resultType="com.pj.movie.dto.PmMovieDto" parameterType="String">
        select *
        from PM_MOVIE
    </select>
    <select id="screeningDate" resultType="com.pj.movie.dto.PmDayDto" parameterType="String">
        select *
        from PM_DAY
    </select>
    <select id="screeningtime" resultType="com.pj.movie.dto.PmTimeDto" parameterType="int">
        select *
        FROM PM_ROOM_HH
        where PRH_ROOM=#{pmId}
    </select>
    <select id="selectSeat" resultType="com.pj.movie.dto.PmSeatDto" parameterType="com.pj.movie.dto.RequestSeatInfo">
        select
        T1.*,
        (
        select
        COUNT(*)
        FROM PM_MOVIE_PLAN S1
        WHERE S1.PT_CD = #{ptCd}
        and S1.PM_ID = #{pmId}
        and S1.PD_CD = #{pdCd}
        and S1.PRH_CD = #{prhCd}
        and S1.PS_CD = T1.PS_CD
        ) as CHECK_SEAT
        from PM_SEAT T1;
    </select>
    <insert id="tryReservation" parameterType="com.pj.movie.dto.PmMoviePlanDto">
        insert
        into PM_MOVIE_PLAN(PT_CD,PD_CD,PM_ID,PRH_CD,PS_CD)
        values(#{ptCd},#{pdCd},#{pmId},#{prhCd},#{psCd})

    </insert>

</mapper>